<title>SWAPi</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
 <script>
    $(document).ready(function(){
        $('#all button').hide();
        $('#next button').hide();
        $('#previous button').hide();
        $('button.get').click(function(){
            const type = $(this).attr('ref');
            $(`#all button`).attr('ref', type);
            $.get(`/fetch${type}`, function(data){
                let next = data.next ? data.next.match(/\d+$/)[0] : 0;
                let previous = data.previous ? data.previous.match(/\d+$/)[0] : 0;
                setAll(data.count, type.slice(1));
                set(next, 'next', type);
                set(previous, 'previous', type);
                setResults(data.results);
            }, 'json');

        });

        $('button.page').click(function(){
            const type = $(this).attr('type');
            const page = $(this).attr('page');
            $.get(`/fetch${type}/${page}`, function(data){
                let next = data.next ? data.next.match(/\d+$/)[0] : 0;
                let previous = data.previous ? data.previous.match(/\d+$/)[0] : 0;                
                setAll(data.count, type.slice(1));
                set(next, 'next', type);
                set(previous, 'previous', type);
                setResults(data.results);
            }, 'json');
        });

        $('button.all').click(function(){
            const type = $(this).attr('ref');
            $('#all button').hide();
            $('#next button').hide();
            $('#previous button').hide();
            $.get(`/fetch${type}`, function(data){
               console.log(data.results);
               let results = data.results;
               setResults(results);
               let next = data.next ? data.next.match(/\d+$/)[0] : 0;
            }, 'json');
                
            while (next > 0){
                $.get(`/fetch${type}/${next}`, function(page){
                    console.log(page);                        
                    next = page.results.next ? page.results.next.match(/\d+$/)[0] : 0;
                }, 'json');
            }
        });

        const setResults = (data) => {
            console.log(data);
            $('#results').html('');
            for (let i = 0; i < data.length; i++){
                $('#results').append(`<p>${data[i].name}</p>`);
            }
        }

        const setAll = (num, type) => {
            $('#all button').show();
            $('#all button').html(`Get all ${num} ${type}`);
        }

        const set = (num, nav, type) => {
           if ( num > 0 ) {
                $(`#${nav} button`).show();
                $(`#${nav} button`).html(`Get page ${num}`);
                $(`#${nav} button`).attr('page', num);
                $(`#${nav} button`).attr('type', type);
            } else {
                $(`#${nav} button`).hide();
            }
        }        
    });
</script>
<body>
    <div class="container mt-3">
        <div class="row">
            <div class="col">
                <h1 class="text-center">Star Wars Wiki</h1>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <h3 class="text-center">What would you like to know more about?</h3>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <button ref="/people" class="btn btn-primary btn-lg get">People</button>
            </div>
            <div class="col text-right">
                <button ref="/planets" class="btn btn-primary btn-lg get">Planets</button>
            </div>
        </div>
        <div class="row">
            <div class="col text-center border border-dark mt-3 p-2" id="results">
            <p>No data</p>
            </div>
        </div>
        <div class="row mt-2">
            <div class="col" id="previous">
                <button ref="/previous" class="btn btn-dark btn-sm text-white page" page="0" >Previous 10</button>
            </div>
            <div class="col text-center" id="all">            
                <button class="btn btn-dark btn-sm text-whitei all"></button>
            </div>
            <div class="col text-right" id="next">            
                <button ref="/next" class="btn btn-dark btn-sm text-white page" page="0">Next 10</button>
            </div>
        </div>
    </div>
</body>
